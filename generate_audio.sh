#!/bin/bash
# Генерация аудиофайлов для словарных слов 2 класса

PROJECT_DIR="/mnt/c/work08-projs/russian-spelling-test"
AUDIO_DIR="$PROJECT_DIR/audio/ru"

# Создаём директорию если не существует
mkdir -p "$AUDIO_DIR"

# Загружаем .env из корня проекта
cd "$PROJECT_DIR"
if [ -f .env ]; then
    export $(cat .env | grep -v '^#' | xargs)
fi

cd "$AUDIO_DIR"

# Массив словосочетаний и слов (фраза;слово)
declare -a words=(
    "учить алфавит;алфавит"
    "тёплый апрель;апрель"
    "тяжёлый багаж;багаж"
    "зелёная берёза;берёза"
    "бежать быстро;быстро"
    "пассажирский вагон;вагон"
    "тёплые варежки;варежки"
    "включить вдруг;вдруг"
    "сильный ветер;ветер"
    "белый воротник;воротник"
    "большой город;город"
    "дружная группа;группа"
    "холодный декабрь;декабрь"
    "мягкий диван;диван"
    "главный директор;директор"
    "сказать до свидания;до_свидания"
    "длинная дорога;дорога"
    "жёлтый мяч;жёлтый"
    "большой завод;завод"
    "сказать здравствуйте;здравствуйте"
    "сладкая земляника;земляника"
    "сказать извините;извините"
    "белый иней;иней"
    "квашеная капуста;капуста"
    "красивая картина;картина"
    "платёжная квитанция;квитанция"
    "кататься на коньках;коньки"
    "полная корзина;корзина"
    "деревянная лопата;лопата"
    "зелёная лягушка;лягушка"
    "продуктовый магазин;магазин"
    "спелая малина;малина"
    "мягкая мебель;мебель"
    "первый месяц;месяц"
    "сильная метель;метель"
    "ехать в метро;метро"
    "свежее молоко;молоко"
    "железный молоток;молоток"
    "сладкая морковь;морковь"
    "сильный мороз;мороз"
    "великий народ;народ"
    "пасмурный ноябрь;ноябрь"
    "вкусный обед;обед"
    "смешная обезьяна;обезьяна"
    "белое облако;облако"
    "тёплая одежда;одежда"
    "золотой октябрь;октябрь"
    "дрожит осина;осина"
    "любимый отец;отец"
    "тёплое пальто;пальто"
    "внимательный пассажир;пассажир"
    "пассажирский поезд;пассажирский"
    "школьный пенал;пенал"
    "железнодорожный перрон;перрон"
    "яркий петух;петух"
    "шёлковый платок;платок"
    "скажите пожалуйста;пожалуйста"
    "оказать помощь;помощь"
    "чистая посуда;посуда"
    "сказать прощай;прощай"
    "смелый путешественник;путешественник"
    "интересная работа;работа"
    "добрый рабочий;рабочий"
    "весёлые ребята;ребята"
    "красивый рисунок;рисунок"
    "кожаный саквояж;саквояж"
    "зимние сапоги;сапоги"
    "белый сахар;сахар"
    "ранний сентябрь;сентябрь"
    "прийти скоро;скоро"
    "красивый снегирь;снегирь"
    "белобокая сорока;сорока"
    "сказать спасибо;спасибо"
    "полный стакан;стакан"
    "весёлая суббота;суббота"
    "суффикс щек;суффикс"
    "глубокая тарелка;тарелка"
    "новая тетрадь;тетрадь"
    "верный товарищ;товарищ"
    "острый топор;топор"
    "широкая улица;улица"
    "богатый урожай;урожай"
    "участвовать в игре;участвовать"
    "добрая учительница;учительница"
    "русская фамилия;фамилия"
    "последний февраль;февраль"
    "большой чемодан;чемодан"
    "чувствовать радость;чувствовать"
    "шел он;шёл"
    "кислый щавель;щавель"
    "красное яблоко;яблоко"
    "цветущая яблоня;яблоня"
    "спелая ягода;ягода"
    "морозный январь;январь"
)

total=${#words[@]}
echo "Генерация $total аудиофайлов..."
echo "Директория: $AUDIO_DIR"

count=0
for item in "${words[@]}"; do
    IFS=';' read -r phrase word <<< "$item"
    count=$((count + 1))

    echo "[$count/$total] Генерация: $word ($phrase)"

    # Формируем текст с паузами в формате Яндекса (начальное тире обязательно!)
    text="-sil<[400]> ${phrase} sil<[400]>${word}"

    # Генерируем аудио через tts.sh (используем printf и полный путь к tts.sh в WSL)
    TTS_SCRIPT="/mnt/c/work08-projs/russian-spelling-test/tts.sh"
    printf '%s' "$text" | bash "$TTS_SCRIPT" > "${word}.mp3"

    # Небольшая задержка между запросами к API
    sleep 0.2
done

echo ""
echo "Готово! Сгенерировано файлов: $(ls -1 *.mp3 2>/dev/null | wc -l)"
